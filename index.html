<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Attendance System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center justify-center p-4">
  <header class="w-full max-w-4xl mb-8 text-center">
    <h1 class="text-3xl md:text-4xl font-bold text-indigo-800 mb-2">Smart Attendance System</h1>
    <p class="text-gray-600">Efficient and modern way to track attendance</p>
  </header>

  <!-- Student Section -->
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-md mb-6" id="studentSection">
    <h2 class="text-2xl font-bold text-center mb-4">üìå Student Attendance</h2>
    <label for="rollNo" class="block mb-2 font-medium">Enter EC Number</label>
    <input id="rollNo" type="text" class="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="EC Number (e.g., 123456)" maxlength="6">
    <button onclick="submitAttendance()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg font-medium transition duration-300">
      Submit Attendance
    </button>
    <div id="spinner" class="hidden text-center mt-3">
      <div class="inline-flex items-center">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>Saving...</span>
      </div>
    </div>
    <p id="responseMsg" class="text-center mt-3 p-2 rounded-lg"></p>
    
    <div class="mt-4 text-center">
      <button onclick="toggleLogin()" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
        Admin Login
      </button>
    </div>
  </div>

  <!-- Admin Login -->
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-md mb-6 hidden" id="loginSection">
    <h2 class="text-2xl font-bold text-center mb-4">üîë Admin Login</h2>
    <label for="adminUsername" class="block mb-2 font-medium">Username</label>
    <input id="adminUsername" type="text" class="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Admin username">
    <label for="adminPassword" class="block mb-2 font-medium">Password</label>
    <input id="adminPassword" type="password" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Admin password">
    <button onclick="adminLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-medium transition duration-300">
      Login
    </button>
    <div class="mt-4 text-center">
      <button onclick="toggleLogin()" class="text-gray-600 hover:text-gray-800 text-sm">
        ‚Üê Back to Attendance
      </button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-6xl hidden" id="adminSection">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">üìä Attendance Records</h2>
      <button onclick="adminLogout()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg text-sm">
        Logout
      </button>
    </div>

    <div class="flex flex-wrap gap-2 mb-6">
      <button onclick="exportToPDF()" class="flex-1 bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Export PDF
      </button>
      <button onclick="exportToExcel()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Export Excel
      </button>
      <button onclick="deleteAllData()" class="flex-1 bg-gray-700 hover:bg-gray-800 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Delete All
      </button>
    </div>

    <div class="mb-4 flex items-center">
      <span class="mr-2 font-medium">Filter:</span>
      <input type="text" id="searchInput" placeholder="Search by EC Number..." class="p-2 border border-gray-300 rounded-lg flex-grow max-w-md">
    </div>

    <div class="overflow-x-auto rounded-lg shadow">
      <table id="attendanceTable" class="min-w-full border border-gray-300 text-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-3 font-medium">S.No</th>
            <th class="border p-3 font-medium">EC Number</th>
            <th class="border p-3 font-medium">Date</th>
            <th class="border p-3 font-medium">Time</th>
            <th class="border p-3 font-medium">Image</th>
            <th class="border p-3 font-medium">Actions</th>
          </tr>
        </thead>
        <tbody id="attendanceBody"></tbody>
      </table>
    </div>
    
    <div class="mt-4 text-sm text-gray-600">
      Total Records: <span id="totalRecords">0</span>
    </div>
  </div>

  <!-- GitHub Section -->
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-md mt-6">
    <h2 class="text-2xl font-bold text-center mb-4">üêô GitHub Repository</h2>
    <p class="text-center mb-4">Access the source code and contribute to this project</p>
    <a href="https://github.com" target="_blank" class="block w-full bg-gray-800 hover:bg-gray-900 text-white p-3 rounded-lg font-medium text-center transition duration-300">
      Open GitHub Repository
    </a>
  </div>

<script>
  let attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || [];
  let currentEditId = null;

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    renderAttendanceTable();
    updateRecordCount();
  });

  // Toggle between login and student sections
  function toggleLogin() {
    const studentSection = document.getElementById('studentSection');
    const loginSection = document.getElementById('loginSection');
    
    if (loginSection.classList.contains('hidden')) {
      studentSection.classList.add('hidden');
      loginSection.classList.remove('hidden');
    } else {
      loginSection.classList.add('hidden');
      studentSection.classList.remove('hidden');
    }
  }

  // ‚úÖ Student Attendance
  function submitAttendance() {
    const rollNo = document.getElementById("rollNo").value.trim();
    const responseMsg = document.getElementById("responseMsg");

    responseMsg.textContent = "";
    responseMsg.className = "text-center mt-3 p-2 rounded-lg";

    if (rollNo === "") {
      responseMsg.textContent = "‚ùå Please enter your EC Number.";
      responseMsg.classList.add("bg-red-100", "text-red-700");
      return;
    }

    if (!/^[0-9]{1,6}$/.test(rollNo)) {
      responseMsg.textContent = "‚ùå EC Number must be numeric (max 6 digits).";
      responseMsg.classList.add("bg-red-100", "text-red-700");
      return;
    }

    // Check if attendance already marked today
    const today = new Date().toLocaleDateString();
    if (attendanceRecords.some(rec => rec.rollNo === rollNo && rec.date === today)) {
      responseMsg.textContent = "‚ö†Ô∏è Attendance already marked for this EC Number today.";
      responseMsg.classList.add("bg-yellow-100", "text-yellow-700");
      return;
    }

    document.getElementById("spinner").classList.remove("hidden");
    responseMsg.textContent = "‚è≥ Submitting...";
    responseMsg.classList.add("bg-blue-100", "text-blue-700");

    setTimeout(() => {
      document.getElementById("spinner").classList.add("hidden");

      const now = new Date();
      const record = {
        id: Date.now(), // Unique ID for each record
        rollNo: rollNo,
        time: now.toLocaleTimeString(),
        date: now.toLocaleDateString(),
        img: `https://picsum.photos/seed/${rollNo}/40`
      };
      
      attendanceRecords.unshift(record); // Add to beginning of array
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));

      responseMsg.textContent = "‚úÖ Attendance marked successfully!";
      responseMsg.classList.remove("bg-blue-100", "text-blue-700");
      responseMsg.classList.add("bg-green-100", "text-green-700");

      document.getElementById("rollNo").value = "";
      renderAttendanceTable();
      updateRecordCount();
    }, 1000);
  }

  // ‚úÖ Render Attendance Table
  function renderAttendanceTable() {
    const tbody = document.getElementById("attendanceBody");
    tbody.innerHTML = "";

    const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
    let filteredRecords = attendanceRecords;
    
    if (searchTerm) {
      filteredRecords = attendanceRecords.filter(r => 
        r.rollNo.toLowerCase().includes(searchTerm)
      );
    }

    if (filteredRecords.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td colspan="6" class="border p-3 text-center text-gray-500">No attendance records found</td>
      `;
      tbody.appendChild(tr);
      return;
    }

    filteredRecords.forEach((r, index) => {
      const tr = document.createElement("tr");
      tr.className = "hover:bg-gray-50";

      tr.innerHTML = `
        <td class="border p-2 text-center">${index + 1}</td>
        <td class="border p-2 text-center">${r.rollNo}</td>
        <td class="border p-2 text-center">${r.date}</td>
        <td class="border p-2 text-center">${r.time}</td>
        <td class="border p-2 text-center"><img src="${r.img}" class="w-10 h-10 rounded-full mx-auto" alt="Student Image"/></td>
        <td class="border p-2 text-center">
          <button onclick="editRecord(${r.id})" class="bg-blue-500 hover:bg-blue-600 text-white p-1 rounded mr-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </button>
          <button onclick="deleteRecord(${r.id})" class="bg-red-500 hover:bg-red-600 text-white p-1 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Edit record
  function editRecord(id) {
    const record = attendanceRecords.find(r => r.id === id);
    if (!record) return;
    
    const newRollNo = prompt("Edit EC Number:", record.rollNo);
    if (newRollNo !== null && newRollNo.trim() !== "" && /^[0-9]{1,6}$/.test(newRollNo)) {
      record.rollNo = newRollNo.trim();
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
      renderAttendanceTable();
    } else if (newRollNo !== null) {
      alert("EC Number must be numeric (max 6 digits)");
    }
  }

  // Delete single record
  function deleteRecord(id) {
    if (confirm("Are you sure you want to delete this record?")) {
      attendanceRecords = attendanceRecords.filter(r => r.id !== id);
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
      renderAttendanceTable();
      updateRecordCount();
    }
  }

  // Update record count
  function updateRecordCount() {
    document.getElementById('totalRecords').textContent = attendanceRecords.length;
  }

  // ‚úÖ Admin Login
  function adminLogin() {
    const username = document.getElementById("adminUsername").value.trim();
    const password = document.getElementById("adminPassword").value.trim();

    if (username === "" || password === "") {
      alert("‚ö†Ô∏è Please enter both Username and Password.");
      return;
    }

    if (username !== "admin" || password !== "1234") {
      alert("‚ùå Invalid username or password.");
      return;
    }

    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("adminSection").classList.remove("hidden");
    
    // Add event listener for search
    document.getElementById('searchInput').addEventListener('input', renderAttendanceTable);
  }

  // Admin logout
  function adminLogout() {
    document.getElementById("adminSection").classList.add("hidden");
    document.getElementById("studentSection").classList.remove("hidden");
    document.getElementById("adminUsername").value = "";
    document.getElementById("adminPassword").value = "";
  }

  // ‚úÖ Export PDF
  function exportToPDF() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to export.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Title
    doc.setFontSize(20);
    doc.setTextColor(40, 40, 40);
    doc.text("Attendance Report", 14, 22);
    
    // Date
    doc.setFontSize(12);
    doc.setTextColor(100, 100, 100);
    doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 30);
    
    // Table
    const tableData = attendanceRecords.map(r => [r.rollNo, r.date, r.time]);
    doc.autoTable({
      head: [["EC Number", "Date", "Time"]],
      body: tableData,
      startY: 40,
      theme: 'grid',
      headStyles: {
        fillColor: [79, 70, 229],
        textColor: 255
      },
      alternateRowStyles: {
        fillColor: [240, 240, 240]
      }
    });

    doc.save(`Attendance_Report_${new Date().toISOString().slice(0,10)}.pdf`);
  }

  // ‚úÖ Export Excel (using SheetJS)
  function exportToExcel() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to export.");
      return;
    }

    const worksheet = XLSX.utils.json_to_sheet(attendanceRecords.map(r => ({
      "EC Number": r.rollNo,
      "Date": r.date,
      "Time": r.time
    })));
    
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Attendance");
    XLSX.writeFile(workbook, `Attendance_Report_${new Date().toISOString().slice(0,10)}.xlsx`);
  }

  // ‚úÖ Delete All
  function deleteAllData() {
    if (confirm("‚ö†Ô∏è Delete all attendance records? This action cannot be undone.")) {
      attendanceRecords = [];
      localStorage.removeItem('attendanceRecords');
      renderAttendanceTable();
      updateRecordCount();
      alert("‚úÖ All data cleared.");
    }
  }
</script>

</body>
</html>