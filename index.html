<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Smart Attendance System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center justify-center p-4">
  <header class="w-full max-w-4xl mb-4 md:mb-8 text-center">
    <h1 class="text-2xl md:text-4xl font-bold text-indigo-800 mb-2">Smart Attendance System</h1>
    <p class="text-sm md:text-base text-gray-600">Multi-user attendance tracking with sharing options</p>
  </header>

  <!-- Student Section -->
  <div class="bg-white shadow-xl rounded-2xl p-4 md:p-6 w-full max-w-md mb-4 md:mb-6" id="studentSection">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-3 md:mb-4">üìå Student Attendance</h2>
    <label for="rollNo" class="block mb-2 font-medium text-sm md:text-base">Enter EC Number</label>
    <input id="rollNo" type="text" inputmode="numeric" pattern="[0-9]*" class="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-indigo-500 focus:outline-none text-base md:text-lg" placeholder="EC Number (e.g., 123456)" maxlength="6">
    <button onclick="submitAttendance()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg font-medium transition duration-300 text-base md:text-lg touch-button">
      Submit Attendance
    </button>
    <div id="spinner" class="hidden text-center mt-3">
      <div class="inline-flex items-center">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="text-sm md:text-base">Saving...</span>
      </div>
    </div>
    <p id="responseMsg" class="text-center mt-3 p-2 rounded-lg text-sm md:text-base"></p>
    
    <div class="mt-4 text-center flex flex-col gap-2">
      <button onclick="toggleLogin()" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium touch-button">
        Admin Login
      </button>
      <button onclick="toggleShare()" class="text-green-600 hover:text-green-800 text-sm font-medium touch-button">
        Share Data
      </button>
    </div>
  </div>

  <!-- Admin Login -->
  <div class="bg-white shadow-xl rounded-2xl p-4 md:p-6 w-full max-w-md mb-4 md:mb-6 hidden" id="loginSection">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-3 md:mb-4">üîë Admin Login</h2>
    <label for="adminUsername" class="block mb-2 font-medium text-sm md:text-base">Username</label>
    <input id="adminUsername" type="text" class="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-green-500 focus:outline-none text-base md:text-lg" placeholder="Admin username">
    <label for="adminPassword" class="block mb-2 font-medium text-sm md:text-base">Password</label>
    <input id="adminPassword" type="password" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-green-500 focus:outline-none text-base md:text-lg" placeholder="Admin password">
    <button onclick="adminLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-medium transition duration-300 text-base md:text-lg touch-button">
      Login
    </button>
    <div class="mt-4 text-center">
      <button onclick="toggleLogin()" class="text-gray-600 hover:text-gray-800 text-sm touch-button">
        ‚Üê Back to Attendance
      </button>
    </div>
  </div>

  <!-- Share Data Section -->
  <div class="bg-white shadow-xl rounded-2xl p-4 md:p-6 w-full max-w-md mb-4 md:mb-6 hidden" id="shareSection">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-3 md:mb-4">üîó Share Attendance Data</h2>
    
    <div class="mb-4">
      <label class="block mb-2 font-medium text-sm md:text-base">Share via WhatsApp</label>
      <div class="flex gap-2">
        <input type="text" id="whatsappNumber" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none text-sm" placeholder="WhatsApp number">
        <button onclick="shareViaWhatsApp()" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-medium transition duration-300 touch-button whitespace-nowrap">
          Send
        </button>
      </div>
      <p class="text-xs text-gray-500 mt-1">Enter number with country code (e.g., +1234567890)</p>
    </div>
    
    <div class="mb-4">
      <label class="block mb-2 font-medium text-sm md:text-base">Share via Email</label>
      <div class="flex gap-2">
        <input type="email" id="emailAddress" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm" placeholder="Email address">
        <button onclick="shareViaEmail()" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-medium transition duration-300 touch-button whitespace-nowrap">
          Send
        </button>
      </div>
    </div>
    
    <div class="mb-4 p-3 bg-gray-100 rounded-lg">
      <label class="block mb-2 font-medium text-sm md:text-base">Quick Share Options</label>
      
      <div class="grid grid-cols-2 gap-2">
        <button onclick="sharePDF()" class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg text-xs touch-button flex items-center justify-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Share PDF
        </button>
        
        <button onclick="shareExcel()" class="bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg text-xs touch-button flex items-center justify-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Share Excel
        </button>
      </div>
      
      <p class="text-xs text-gray-500 mt-2">These will generate files for sharing</p>
    </div>
    
    <div class="text-center">
      <button onclick="toggleShare()" class="text-gray-600 hover:text-gray-800 text-sm touch-button">
        ‚Üê Back to Attendance
      </button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div class="bg-white shadow-xl rounded-2xl p-4 md:p-6 w-full max-w-6xl hidden" id="adminSection">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-2">
      <h2 class="text-xl md:text-2xl font-bold">üìä Attendance Records</h2>
      <div class="flex gap-2">
        <button onclick="toggleShare()" class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg text-sm touch-button">
          Share Data
        </button>
        <button onclick="adminLogout()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg text-sm touch-button">
          Logout
        </button>
      </div>
    </div>

    <div class="flex flex-col md:flex-row gap-2 mb-4 md:mb-6">
      <button onclick="exportToPDF()" class="flex-1 bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2 text-sm md:text-base touch-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Export PDF
      </button>
      <button onclick="exportToExcel()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2 text-sm md:text-base touch-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Export Excel
      </button>
      <button onclick="deleteAllData()" class="flex-1 bg-gray-700 hover:bg-gray-800 text-white p-3 rounded-lg font-medium transition duration-300 flex items-center justify-center gap-2 text-sm md:text-base touch-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Delete All
      </button>
    </div>

    <div class="mb-4 flex flex-col md:flex-row items-start md:items-center gap-2">
      <span class="font-medium text-sm md:text-base">Filter:</span>
      <input type="text" id="searchInput" placeholder="Search by EC Number..." class="p-2 border border-gray-300 rounded-lg flex-grow w-full md:max-w-md text-base md:text-lg">
    </div>

    <div class="overflow-x-auto rounded-lg shadow" style="max-height: 60vh;">
      <table id="attendanceTable" class="min-w-full border border-gray-300 text-xs md:text-sm">
        <thead class="bg-gray-200 sticky top-0">
          <tr>
            <th class="border p-2 md:p-3 font-medium">S.No</th>
            <th class="border p-2 md:p-3 font-medium">EC Number</th>
            <th class="border p-2 md:p-3 font-medium">Date</th>
            <th class="border p-2 md:p-3 font-medium">Time</th>
            <th class="border p-2 md:p-3 font-medium">Image</th>
            <th class="border p-2 md:p-3 font-medium">Actions</th>
          </tr>
        </thead>
        <tbody id="attendanceBody"></tbody>
      </table>
    </div>
    
    <div class="mt-4 text-sm text-gray-600">
      Total Records: <span id="totalRecords">0</span>
    </div>
  </div>

  <!-- Footer Section -->
  <div class="bg-white shadow-xl rounded-2xl p-4 md:p-6 w-full max-w-md mt-4 md:mt-6">
    <h2 class="text-xl md:text-2xl font-bold text-center mb-3 md:mb-4">üì§ Share Options</h2>
    <p class="text-center mb-4 text-sm md:text-base">Share attendance data via WhatsApp or Email</p>
    
    <div class="grid grid-cols-2 gap-3">
      <button onclick="toggleShare()" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-medium text-center transition duration-300 text-sm touch-button flex items-center justify-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.05-.084-.182-.133-.38-.232z"/>
        </svg>
        WhatsApp
      </button>
      
      <button onclick="toggleShare()" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-medium text-center transition duration-300 text-sm touch-button flex items-center justify-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
        </svg>
        Email
      </button>
    </div>
  </div>

<script>
  let attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || [];
  let currentEditId = null;
  let shareableLink = '';

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    // Add touch-specific event listeners
    addTouchSupport();
    
    renderAttendanceTable();
    updateRecordCount();
    
    // Add search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
      searchInput.addEventListener('input', renderAttendanceTable);
    }
  });

  // Add touch-friendly support
  function addTouchSupport() {
    // Add touch feedback for buttons
    const buttons = document.querySelectorAll('.touch-button');
    buttons.forEach(button => {
      button.addEventListener('touchstart', function() {
        this.classList.add('opacity-80', 'scale-95');
      });
      
      button.addEventListener('touchend', function() {
        this.classList.remove('opacity-80', 'scale-95');
      });
    });
    
    // Prevent zoom on input focus
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        document.body.style.zoom = "100%";
      });
    });
  }

  // Toggle between login and student sections
  function toggleLogin() {
    const studentSection = document.getElementById('studentSection');
    const loginSection = document.getElementById('loginSection');
    const shareSection = document.getElementById('shareSection');
    
    shareSection.classList.add('hidden');
    
    if (loginSection.classList.contains('hidden')) {
      studentSection.classList.add('hidden');
      loginSection.classList.remove('hidden');
    } else {
      loginSection.classList.add('hidden');
      studentSection.classList.remove('hidden');
    }
  }

  // Toggle share section
  function toggleShare() {
    const studentSection = document.getElementById('studentSection');
    const loginSection = document.getElementById('loginSection');
    const shareSection = document.getElementById('shareSection');
    const adminSection = document.getElementById('adminSection');
    
    loginSection.classList.add('hidden');
    
    if (shareSection.classList.contains('hidden')) {
      studentSection.classList.add('hidden');
      adminSection.classList.add('hidden');
      shareSection.classList.remove('hidden');
    } else {
      shareSection.classList.add('hidden');
      if (adminSection.classList.contains('hidden')) {
        studentSection.classList.remove('hidden');
      } else {
        adminSection.classList.remove('hidden');
      }
    }
  }

  // ‚úÖ Student Attendance
  function submitAttendance() {
    const rollNo = document.getElementById("rollNo").value.trim();
    const responseMsg = document.getElementById("responseMsg");

    responseMsg.textContent = "";
    responseMsg.className = "text-center mt-3 p-2 rounded-lg";

    if (rollNo === "") {
      responseMsg.textContent = "‚ùå Please enter your EC Number.";
      responseMsg.classList.add("bg-red-100", "text-red-700");
      return;
    }

    if (!/^[0-9]{1,6}$/.test(rollNo)) {
      responseMsg.textContent = "‚ùå EC Number must be numeric (max 6 digits).";
      responseMsg.classList.add("bg-red-100", "text-red-700");
      return;
    }

    // Check if attendance already marked today
    const today = new Date().toLocaleDateString();
    if (attendanceRecords.some(rec => rec.rollNo === rollNo && rec.date === today)) {
      responseMsg.textContent = "‚ö†Ô∏è Attendance already marked for this EC Number today.";
      responseMsg.classList.add("bg-yellow-100", "text-yellow-700");
      return;
    }

    document.getElementById("spinner").classList.remove("hidden");
    responseMsg.textContent = "‚è≥ Submitting...";
    responseMsg.classList.add("bg-blue-100", "text-blue-700");

    setTimeout(() => {
      document.getElementById("spinner").classList.add("hidden");

      const now = new Date();
      const record = {
        id: Date.now(), // Unique ID for each record
        rollNo: rollNo,
        time: now.toLocaleTimeString(),
        date: now.toLocaleDateString(),
        img: `https://picsum.photos/seed/${rollNo}/40`
      };
      
      attendanceRecords.unshift(record); // Add to beginning of array
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));

      responseMsg.textContent = "‚úÖ Attendance marked successfully!";
      responseMsg.classList.remove("bg-blue-100", "text-blue-700");
      responseMsg.classList.add("bg-green-100", "text-green-700");

      document.getElementById("rollNo").value = "";
      renderAttendanceTable();
      updateRecordCount();
      
      // Clear success message after 3 seconds
      setTimeout(() => {
        responseMsg.textContent = "";
        responseMsg.className = "text-center mt-3 p-2 rounded-lg";
      }, 3000);
    }, 1000);
  }

  // ‚úÖ Render Attendance Table
  function renderAttendanceTable() {
    const tbody = document.getElementById("attendanceBody");
    tbody.innerHTML = "";

    const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
    let filteredRecords = attendanceRecords;
    
    if (searchTerm) {
      filteredRecords = attendanceRecords.filter(r => 
        r.rollNo.toLowerCase().includes(searchTerm)
      );
    }

    if (filteredRecords.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td colspan="6" class="border p-3 text-center text-gray-500">No attendance records found</td>
      `;
      tbody.appendChild(tr);
      return;
    }

    filteredRecords.forEach((r, index) => {
      const tr = document.createElement("tr");
      tr.className = "hover:bg-gray-50";

      tr.innerHTML = `
        <td class="border p-1 md:p-2 text-center">${index + 1}</td>
        <td class="border p-1 md:p-2 text-center">${r.rollNo}</td>
        <td class="border p-1 md:p-2 text-center">${r.date}</td>
        <td class="border p-1 md:p-2 text-center">${r.time}</td>
        <td class="border p-1 md:p-2 text-center"><img src="${r.img}" class="w-8 h-8 md:w-10 md:h-10 rounded-full mx-auto" alt="Student Image"/></td>
        <td class="border p-1 md:p-2 text-center">
          <button onclick="editRecord(${r.id})" class="bg-blue-500 hover:bg-blue-600 text-white p-1 rounded mr-1 touch-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 md:h-4 md:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </button>
          <button onclick="deleteRecord(${r.id})" class="bg-red-500 hover:bg-red-600 text-white p-1 rounded touch-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 md:h-4 md:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Edit record
  function editRecord(id) {
    const record = attendanceRecords.find(r => r.id === id);
    if (!record) return;
    
    const newRollNo = prompt("Edit EC Number:", record.rollNo);
    if (newRollNo !== null && newRollNo.trim() !== "" && /^[0-9]{1,6}$/.test(newRollNo)) {
      record.rollNo = newRollNo.trim();
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
      renderAttendanceTable();
    } else if (newRollNo !== null) {
      alert("EC Number must be numeric (max 6 digits)");
    }
  }

  // Delete single record
  function deleteRecord(id) {
    if (confirm("Are you sure you want to delete this record?")) {
      attendanceRecords = attendanceRecords.filter(r => r.id !== id);
      localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
      renderAttendanceTable();
      updateRecordCount();
    }
  }

  // Update record count
  function updateRecordCount() {
    document.getElementById('totalRecords').textContent = attendanceRecords.length;
  }

  // ‚úÖ Admin Login
  function adminLogin() {
    const username = document.getElementById("adminUsername").value.trim();
    const password = document.getElementById("adminPassword").value.trim();

    if (username === "" || password === "") {
      alert("‚ö†Ô∏è Please enter both Username and Password.");
      return;
    }

    if (username !== "admin" || password !== "1234") {
      alert("‚ùå Invalid username or password.");
      return;
    }

    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("adminSection").classList.remove("hidden");
    
    // Add event listener for search
    document.getElementById('searchInput').addEventListener('input', renderAttendanceTable);
  }

  // Admin logout
  function adminLogout() {
    document.getElementById("adminSection").classList.add("hidden");
    document.getElementById("studentSection").classList.remove("hidden");
    document.getElementById("adminUsername").value = "";
    document.getElementById("adminPassword").value = "";
  }

  // Share via WhatsApp
  function shareViaWhatsApp() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to share.");
      return;
    }
    
    const phoneNumber = document.getElementById('whatsappNumber').value.trim();
    if (!phoneNumber) {
      alert("Please enter a WhatsApp number");
      return;
    }
    
    // Format the data as text
    const dataText = formatDataAsText();
    
    // Create WhatsApp share link
    const whatsappUrl = `https://wa.me/${phoneNumber.replace(/\D/g, '')}?text=${encodeURIComponent(dataText)}`;
    
    // Open in new tab
    window.open(whatsappUrl, '_blank');
  }

  // Share via Email
  function shareViaEmail() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to share.");
      return;
    }
    
    const email = document.getElementById('emailAddress').value.trim();
    if (!email) {
      alert("Please enter an email address");
      return;
    }
    
    // Format the data as text
    const dataText = formatDataAsText();
    const subject = "Attendance Records";
    const body = `Please find the attendance records attached:\n\n${dataText}`;
    
    // Create mailto link
    const mailtoUrl = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    // Open email client
    window.location.href = mailtoUrl;
  }

  // Share PDF file
  function sharePDF() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to share.");
      return;
    }
    
    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Title
    doc.setFontSize(20);
    doc.setTextColor(40, 40, 40);
    doc.text("Attendance Report", 14, 22);
    
    // Date
    doc.setFontSize(12);
    doc.setTextColor(100, 100, 100);
    doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 30);
    
    // Table
    const tableData = attendanceRecords.map(r => [r.rollNo, r.date, r.time]);
    doc.autoTable({
      head: [["EC Number", "Date", "Time"]],
      body: tableData,
      startY: 40,
      theme: 'grid',
      headStyles: {
        fillColor: [79, 70, 229],
        textColor: 255
      },
      alternateRowStyles: {
        fillColor: [240, 240, 240]
      }
    });

    // Save and download PDF
    doc.save(`Attendance_Report_${new Date().toISOString().slice(0,10)}.pdf`);
    alert("PDF downloaded. You can now share this file via WhatsApp or Email.");
  }

  // Share Excel file
  function shareExcel() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to share.");
      return;
    }

    const worksheet = XLSX.utils.json_to_sheet(attendanceRecords.map(r => ({
      "EC Number": r.rollNo,
      "Date": r.date,
      "Time": r.time
    })));
    
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Attendance");
    XLSX.writeFile(workbook, `Attendance_Report_${new Date().toISOString().slice(0,10)}.xlsx`);
    
    alert("Excel file downloaded. You can now share this file via WhatsApp or Email.");
  }

  // Format data as text for sharing
  function formatDataAsText() {
    let text = "Attendance Records:\n\n";
    text += "EC Number\tDate\t\tTime\n";
    text += "----------------------------------------\n";
    
    attendanceRecords.forEach(record => {
      text += `${record.rollNo}\t\t${record.date}\t${record.time}\n`;
    });
    
    text += `\nTotal Records: ${attendanceRecords.length}`;
    text += `\nGenerated on: ${new Date().toLocaleString()}`;
    
    return text;
  }

  // ‚úÖ Export PDF
  function exportToPDF() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to export.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Title
    doc.setFontSize(20);
    doc.setTextColor(40, 40, 40);
    doc.text("Attendance Report", 14, 22);
    
    // Date
    doc.setFontSize(12);
    doc.setTextColor(100, 100, 100);
    doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 30);
    
    // Table
    const tableData = attendanceRecords.map(r => [r.rollNo, r.date, r.time]);
    doc.autoTable({
      head: [["EC Number", "Date", "Time"]],
      body: tableData,
      startY: 40,
      theme: 'grid',
      headStyles: {
        fillColor: [79, 70, 229],
        textColor: 255
      },
      alternateRowStyles: {
        fillColor: [240, 240, 240]
      }
    });

    doc.save(`Attendance_Report_${new Date().toISOString().slice(0,10)}.pdf`);
  }

  // ‚úÖ Export Excel (using SheetJS)
  function exportToExcel() {
    if (attendanceRecords.length === 0) {
      alert("‚ö†Ô∏è No data to export.");
      return;
    }

    const worksheet = XLSX.utils.json_to_sheet(attendanceRecords.map(r => ({
      "EC Number": r.rollNo,
      "Date": r.date,
      "Time": r.time
    })));
    
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Attendance");
    XLSX.writeFile(workbook, `Attendance_Report_${new Date().toISOString().slice(0,10)}.xlsx`);
  }

  // ‚úÖ Delete All
  function deleteAllData() {
    if (confirm("‚ö†Ô∏è Delete all attendance records? This action cannot be undone.")) {
      attendanceRecords = [];
      localStorage.removeItem('attendanceRecords');
      renderAttendanceTable();
      updateRecordCount();
      alert("‚úÖ All data cleared.");
    }
  }
</script>

</body>
</html>